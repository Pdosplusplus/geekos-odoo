<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>

    <!-- Data file form 

    @ function: Crear y modificar registros 
    @ Descrip: Este data file define como sera el formulario, que datos seran registrados por el usuario etc
    -->
    <record model="ir.ui.view" id="activity_form_view">

      <field name="name">activity.form</field>
      <field name="model">agili.activity</field>
      <field name="arch" type="xml">

        <form string="activity Form">
         <!-- State

            @Description: Añadimos la logica y funcionamiento para trabajar con el estado de un proyecto. Con los siguientes botones controlamos el estado.
          -->
          <header>

            <button name="action_process" type="object"
            string="En Proceso"
            ac_states="stopped,done"/>
            <button name="action_stopped" type="object"
            string="Detenida" ac_states="process,done"
            class="oe_highlight"/>
            <button name="action_done" type="object"
            string="Terminada" ac_states="stopped,process"
            class="oe_highlight"/>

            <field name="ac_state" widget="statusbar"/>

          </header>

          <sheet>
            <!-- Agrupamos los campos generales de una actividad -->
            <group string="General">
              <field name="name"/>
              <field name="objetive"/>
              <field name="ac_type"/>
              <field name="description"/>
              <field name="ac_responsible_id"/>
            </group>

            <!-- Agrupamos los campos que generan la toma de decisiones-->
            <group string="Control">
              <field name="ac_start_date"/>
              <field name="ac_end_date"/>
              <field name="ac_days_plan"/>
              <field name="ac_days_exe"/>
              <field name="result"/>
            </group>

          </sheet>
        </form>

      </field>

    </record>


    <!-- Record search 
      @Function: Para realizar la busqueda de los registros
      
      @Description: Con el record search definimos de que manera seran buscado los registros, definiendo por cuales campos se haran las busquedas, añadiendo domain, entre otros.
    -->
    <record model="ir.ui.view" id="activity_search_view">

      <field name="name">activity.search</field>
      <field name="model">agili.activity</field>

      <field name="arch" type="xml">
        <search>
          <field name="name"/>
          <field name="ac_days_plan"/>
          <field name="description"/>
          <field name="ac_type"/>

          <!-- Filter
          
            @Function: Añadir condiciones a las busuqedes

            @Description: En este caso añadimos un filter para que solo sean mostrados las actividades del usuario logueado.
          -->
          <filter name="my_activities" 
                  string="Mis Actividades"
                  domain="[('ac_responsible_id', '=', uid)]"/>

          <!-- Invocamos al filter creado anteriormente -->
          <group string="Group By">
            <filter name="by_responsible" 
                    string="Responsable" 
                  context="{'group_by': 'ac_responsible_id'}"
            />
          </group>
        </search>

      </field>

    </record>

    <!-- Record tree

      @Function: Listar la información en una tabla

      @Description: Record para mostrar la información en una tabla, donde cada field es una columna.
    -->
    <record model="ir.ui.view" id="activity_tree_view">
      <field name="name">activity.tree</field>
      <field name="model">agili.activity</field>

      <field name="arch" type="xml">
        <tree string="activity Tree">
          <field name="name"/>
          <field name="ac_type"/>
          <field name="ac_start_date"/>
          <field name="ac_end_date"/>
          <field name="ac_responsible_id"/>
          <field name="ac_days_exe"/>
          <field name="ac_state"/>
        </tree>
      </field>

    </record>

    <!-- Record Calendar

       @Function: Mostrar mediante un calendario las fechas de inicio y fin de los proyectos
    -->
    <record model="ir.ui.view" id="activity_calendar_view">
      <field name="name">activity.calendar</field>
      <field name="model">agili.activity</field>
      <field name="arch" type="xml">
        
        <calendar string="activity Calendar" 
                  date_start="ac_start_date" 
                  date_stop="ac_end_date"
                  color="ac_responsible_id">

          <field name="name"/>

        </calendar>

      </field>
    </record>

      <!-- Tag actions.act_window 
      
        @Function: Este tag o record tiene como funcion contralar el flujo de los views a las acciones de los mismos

        @Descripcion: Una de las cosa que ahce este record es definir el modo en que las vistas seran mostradas, en este caso sera primero el <tree>, <form>, <calendar> ,y de ultimo las graficas <graph>.
      -->
      <record model="ir.actions.act_window" id="activity_list_action">

        <field name="name">Actividades</field>
        <field name="res_model">agili.activity</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="context" eval="{'search_default_my_activities': 1}"/>

      </record>

      
      <!-- Añadimos un submenu al menu de gestion de proyectos -->
      <menuitem id="activity_menu" name="Actividades" 
            parent="agili_menu"
            action="activity_list_action"/>

  </data>
</odoo>
